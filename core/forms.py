# این فایل فرم‌های Django رو تعریف می‌کنه.  برای جمع‌آوری داده‌های شخصی و پرسشنامه با اعتبارسنجی خودکار (validation).
from django import forms  # import forms – Form، Field، Widget.

# فرم اطلاعات شخصی –  برای جمع‌آوری داده‌های اولیه کاربر (نام، ایمیل، و غیره) با UI Bootstrap.
class UserInfoForm(forms.Form):
    first_name = forms.CharField(  # فیلد متن برای نام – max_length برای محدودیت طول.
        label='نام',  # لیبل نمایش در template.
        max_length=100,  # حداکثر ۱۰۰ کاراکتر –  جلوگیری از ورودی طولانی.
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'نام خود را وارد کنید'})  # widget با Bootstrap class و placeholder.
    )
    last_name = forms.CharField(  # فیلد متن برای نام خانوادگی – مشابه first_name.
        label='نام خانوادگی', 
        max_length=100,
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'نام خانوادگی خود را وارد کنید'})
    )
    email = forms.CharField(  # فیلد متن برای ایمیل – CharField بدون validation (هر متنی قبول می‌شه).
        label='ایمیل', 
        max_length=254,  # حداکثر طول ایمیل استاندارد.
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'example@domain.com'})  # widget ساده text – بدون type='email'.
    )
    country = forms.ChoiceField(  
        label='کشور', 
                # لیست کامل کشورها – بر اساس ISO 3166-1 alpha-2.
        choices = [
                    ('AF', 'افغانستان'),
                    ('AL', 'آلبانی'),
                    ('DZ', 'الجزایر'),
                    ('AS', 'آمريكاي ساموآ'),
                    ('AD', 'آندورا'),
                    ('AO', 'آنگولا'),
                    ('AI', 'آنگویلا'),
                    ('AG', 'آنتیگوا و باربودا'),
                    ('AR', 'آرژانتین'),
                    ('AM', 'ارمنستان'),
                    ('AW', 'آروبا'),
                    ('AU', 'استرالیا'),
                    ('AT', 'اتریش'),
                    ('AZ', 'آذربایجان'),
                    ('BS', 'باهاما'),
                    ('BH', 'بحرین'),
                    ('BD', 'بنگلادش'),
                    ('BB', 'باربادوس'),
                    ('BY', 'بلاروس'),
                    ('BE', 'بلژیک'),
                    ('BZ', 'بلیز'),
                    ('BJ', 'بنین'),
                    ('BM', 'برمودا'),
                    ('BT', 'بوتان'),
                    ('BO', 'بولیوی'),
                    ('BA', 'بوسنی و هرزگوین'),
                    ('BW', 'بوتسوانا'),
                    ('BV', 'جزیره بوفِت'),
                    ('BR', 'برزیل'),
                    ('IO', 'قلمرو بریتانیایی اقیانوس هند'),
                    ('VG', 'جزایر ویرجین بریتانیایی'),
                    ('BN', 'برونئی'),
                    ('BG', 'بلغارستان'),
                    ('BF', 'بورکینافاسو'),
                    ('BI', 'بوروندی'),
                    ('KH', 'کامبوج'),
                    ('CM', 'کامرون'),
                    ('CA', 'کانادا'),
                    ('CV', 'کیپ ورد'),
                    ('KY', 'جزایر کِی‌من'),
                    ('CF', 'جمهوری آفریقای مرکزی'),
                    ('TD', 'چاد'),
                    ('CL', 'شیلی'),
                    ('CN', 'چین'),
                    ('CX', 'جزیره کریسمس'),
                    ('CC', 'جزایر کوکوس (کیلینگ)'),
                    ('CO', 'کلمبیا'),
                    ('KM', 'کومور'),
                    ('CG', 'کنگو'),
                    ('CD', 'کنگو - کینشاسا'),
                    ('CK', 'جزایر کوک'),
                    ('CR', 'کاستاریکا'),
                    ('CI', 'ساحل عاج'),
                    ('HR', 'کرواسی'),
                    ('CU', 'کوبا'),
                    ('CY', 'قبرس'),
                    ('CZ', 'جمهوری چک'),
                    ('DK', 'دانمارک'),
                    ('DJ', 'جیبوتی'),
                    ('DM', 'دومینیکا'),
                    ('DO', 'جمهوری دومینیکن'),
                    ('EC', 'اکوادور'),
                    ('EG', 'مصر'),
                    ('SV', 'السالوادور'),
                    ('GQ', 'گینه استوایی'),
                    ('ER', 'اریتره'),
                    ('EE', 'استونی'),
                    ('ET', 'اتیوپی'),
                    ('FK', 'جزایر فالکلند'),
                    ('FO', 'جزایر فارو'),
                    ('FJ', 'فیجی'),
                    ('FI', 'فنلاند'),
                    ('FR', 'فرانسه'),
                    ('GF', 'گویان فرانسه'),
                    ('PF', 'پلی‌نزی فرانسه'),
                    ('TF', 'سرزمین‌های جنوب فرانسه'),
                    ('GA', 'گابن'),
                    ('GM', 'گامبیا'),
                    ('GE', 'گرجستان'),
                    ('DE', 'آلمان'),
                    ('GH', 'غنا'),
                    ('GI', 'جبل‌الطارق'),
                    ('GR', 'یونان'),
                    ('GL', 'گرینلند'),
                    ('GD', 'گرنادا'),
                    ('GP', 'گوادلوپ'),
                    ('GU', 'گوام'),
                    ('GT', 'گواتمالا'),
                    ('GG', 'گرنزی'),
                    ('GN', 'گینه'),
                    ('GW', 'گینه بیسائو'),
                    ('GY', 'گویان'),
                    ('HT', 'هائیتی'),
                    ('HM', 'جزایر هرد و مک‌دونالد'),
                    ('VA', 'شهر واتیکان'),
                    ('HN', 'هندوراس'),
                    ('HK', 'هنگ‌کنگ'),
                    ('HU', 'مجارستان'),
                    ('IS', 'ایسلند'),
                    ('IN', 'هند'),
                    ('ID', 'اندونزی'),
                    ('IR', 'ایران'),
                    ('IQ', 'عراق'),
                    ('IE', 'ایرلند'),
                    ('IM', 'جزیره من'),
                    ('IL', 'اسرائیل'),
                    ('IT', 'ایتالیا'),
                    ('CI', 'ساحل عاج'),  
                    ('JM', 'جامائیکا'),
                    ('JP', 'ژاپن'),
                    ('JE', 'جرزی'),
                    ('JO', 'اردن'),
                    ('KZ', 'قزاقستان'),
                    ('KE', 'کنیا'),
                    ('KI', 'کیریباتی'),
                    ('KP', 'کره شمالی'),
                    ('KR', 'کره جنوبی'),
                    ('KW', 'کویت'),
                    ('KG', 'قرقیزستان'),
                    ('LA', 'لائوس'),
                    ('LV', 'لتونی'),
                    ('LB', 'لبنان'),
                    ('LS', 'لسوتو'),
                    ('LR', 'لیبریا'),
                    ('LY', 'لیبی'),
                    ('LI', 'لیختن‌اشتاین'),
                    ('LT', 'لیتوانی'),
                    ('LU', 'لوکزامبورگ'),
                    ('MO', 'ماکائو'),
                    ('MK', 'مقدونیه'),
                    ('MG', 'ماداگاسکار'),
                    ('MW', 'مالاوی'),
                    ('MY', 'مالزی'),
                    ('MV', 'مالدیو'),
                    ('ML', 'مالی'),
                    ('MT', 'مالت'),
                    ('MH', 'جزایر مارشال'),
                    ('MQ', 'مارتینیک'),
                    ('MR', 'موریتانی'),
                    ('MU', 'موریس'),
                    ('YT', 'مایوت'),
                    ('MX', 'مکزیک'),
                    ('FM', 'میکرونزی'),
                    ('MD', 'مولداوی'),
                    ('MC', 'موناکو'),
                    ('MN', 'مغولستان'),
                    ('ME', 'مونته‌نگرو'),
                    ('MS', 'مونتسرات'),
                    ('MA', 'مراکش'),
                    ('MZ', 'موزامبیک'),
                    ('MM', 'میانمار (برمه)'),
                    ('NA', 'نامیبیا'),
                    ('NR', 'نائورو'),
                    ('NP', 'نپال'),
                    ('NL', 'هلند'),
                    ('NC', 'کالدونیای جدید'),
                    ('NZ', 'نیوزیلند'),
                    ('NI', 'نیکاراگوئه'),
                    ('NE', 'نیجر'),
                    ('NG', 'نیجریه'),
                    ('NU', 'نیوئه'),
                    ('NF', 'جزیره نورفولک'),
                    ('MP', 'جزایر ماریانای شمالی'),
                    ('NO', 'نروژ'),
                    ('OM', 'عمان'),
                    ('PK', 'پاکستان'),
                    ('PW', 'پالائو'),
                    ('PS', 'سرزمین‌های فلسطینی'),
                    ('PA', 'پاناما'),
                    ('PG', 'پاپوآ گینه نو'),
                    ('PY', 'پاراگوئه'),
                    ('PE', 'پرو'),
                    ('PH', 'فیلیپین'),
                    ('PN', 'پیتکرن'),
                    ('PL', 'لهستان'),
                    ('PT', 'پرتغال'),
                    ('PR', 'پورتوریکو'),
                    ('QA', 'قطر'),
                    ('RE', 'رئونیون'),
                    ('RO', 'رومانی'),
                    ('RU', 'روسیه'),
                    ('RW', 'رواندا'),
                    ('BL', 'سن بارتلمی'),
                    ('SH', 'سنت هلنا، اسنشن، تریستان دا کونا'),
                    ('KN', 'سنت کیتس و نویس'),
                    ('LC', 'سنت لوسیا'),
                    ('MF', 'سنت مارتن'),
                    ('PM', 'سنت پیر و میکلون'),
                    ('VC', 'سنت وینسنت و گرنادین‌ها'),
                    ('WS', 'ساموآ'),
                    ('SM', 'سن مارینو'),
                    ('ST', 'سائو تومه و پرینسیپ'),
                    ('SA', 'عربستان سعودی'),
                    ('SN', 'سنگال'),
                    ('RS', 'صربستان'),
                    ('SC', 'سیشل'),
                    ('SL', 'سیرالئون'),
                    ('SG', 'سنگاپور'),
                    ('SX', 'سینت مارتن'),
                    ('SK', 'اسلواکی'),
                    ('SI', 'اسلوونی'),
                    ('SB', 'جزایر سلیمان'),
                    ('SO', 'سومالی'),
                    ('ZA', 'آفریقای جنوبی'),
                    ('GS', 'جورجیا جنوبی و جزایر ساندویچ جنوبی'),
                    ('SS', 'سودان جنوبی'),
                    ('ES', 'اسپانیا'),
                    ('LK', 'سری‌لانکا'),
                    ('SD', 'سودان'),
                    ('SR', 'سورینام'),
                    ('SJ', 'سوالبارد و جان ماین'),
                    ('SZ', 'اسواتینی'),
                    ('SE', 'سوئد'),
                    ('CH', 'سوئیس'),
                    ('SY', 'سوریه'),
                    ('TW', 'تایوان'),
                    ('TJ', 'تاجیکستان'),
                    ('TZ', 'تانزانیا'),
                    ('TH', 'تایلند'),
                    ('TL', 'تیمور شرقی'),
                    ('TG', 'توگو'),
                    ('TK', 'توکلائو'),
                    ('TO', 'تونگا'),
                    ('TT', 'ترینیداد و توباگو'),
                    ('TN', 'تونس'),
                    ('TR', 'ترکیه'),
                    ('TM', 'ترکمنستان'),
                    ('TC', 'جزایر تورکس و کایکوس'),
                    ('TV', 'تووالو'),
                    ('UG', 'اوگاندا'),
                    ('UA', 'اوکراین'),
                    ('AE', 'امارات متحده عربی'),
                    ('GB', 'بریتانیا'),
                    ('UM', 'جزایر دورافتاده ایالات متحده'),
                    ('US', 'ایالات متحده'),
                    ('UY', 'اروگوئه'),
                    ('UZ', 'ازبکستان'),
                    ('VU', 'وانواتو'),
                    ('VE', 'ونزوئلا'),
                    ('VN', 'ویتنام'),
                    ('VI', 'جزایر ویرجین ایالات متحده'),
                    ('WF', 'والیس و فوتونا'),
                    ('EH', 'صحرای غربی'),
                    ('YE', 'یمن'),
                    ('ZM', 'زامبیا'),
                    ('ZW', 'زیمبابوه'),
        ],
        widget=forms.Select(attrs={'class': 'form-control'})
    )
    city = forms.CharField(  # فیلد متن برای شهر.
        label='محل زندگی', 
        max_length=100,
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'مثلاً تهران'})
    )
    age = forms.IntegerField(  # فیلد عدد برای سن – min_value validation.
        label='سن', 
        min_value=18,  # حداقل ۱۸ – برای روابط زوج‌ها منطقی.
        widget=forms.NumberInput(attrs={'class': 'form-control', 'min': 18})  # widget با min attribute.
)
    duration_value = forms.IntegerField(  # فیلد عدد برای مقدار مدت (مثل ۳).
        label='مقدار مدت رابطه', 
        min_value=0,  # حداقل ۰ – چرا؟ اجباری نیست.
        widget=forms.NumberInput(attrs={'class': 'form-control', 'min': 0, 'placeholder': 'مثلاً ۳'})  # placeholder برای راهنمایی.
    )
    duration_unit = forms.ChoiceField(  # فیلد انتخابی برای واحد (روز/هفته/ماه/سال).
        label='واحد مدت', 
        choices=[  # گزینه‌ها – tuple (value, label).
            (0, 'روز'),  # ۰ = روز.
            (1, 'هفته'),  # ۱ = هفته.
            (2, 'ماه'),  # ۲ = ماه.
            (3, 'سال')  # ۳ = سال.
        ],
        widget=forms.Select(attrs={'class': 'form-control'})  # select dropdown.
    )
    mbti_type = forms.ChoiceField(  # فیلد انتخابی برای تایپ MBTI – dropdown ۱۶ گزینه.
        label='تایپ شخصیتی MBTI شما', 
        choices=[  # گزینه‌ها – tuple (value, label).
            ('', '--- انتخاب کنید ---'),  # گزینه پیش‌فرض.
            ('INTJ', 'INTJ - معمار'),
            ('INTP', 'INTP - متفکر'),
            ('ENTJ', 'ENTJ - فرمانده'),
            ('ENTP', 'ENTP - بحث‌کننده'),
            ('INFJ', 'INFJ - مدافع'),
            ('INFP', 'INFP - میانجی'),
            ('ENFJ', 'ENFJ - قهرمان'),
            ('ENFP', 'ENFP - مبارز'),
            ('ISTJ', 'ISTJ - لجستیک'),
            ('ISFJ', 'ISFJ - مدافع'),
            ('ESTJ', 'ESTJ - مدیر'),
            ('ESFJ', 'ESFJ - کنسول'),
            ('ISTP', 'ISTP - صنعت‌گر'),
            ('ISFP', 'ISFP - ماجراجو'),
            ('ESTP', 'ESTP - کارآفرین'),
            ('ESFP', 'ESFP - سرگرم‌کننده'),
        ],
        widget=forms.Select(attrs={'class': 'form-control'})  # select dropdown Bootstrap.
    )

# فرم پرسشنامه – (۵۹ سوال DPS).
class QuestionnaireForm(forms.Form):
    # __init__ و clean()
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)  # فراخوانی parent __init__ – fields پایه رو لود کن.
        # لیبل‌های ۵۴ سوال DPS از UCI (Divorce Predictors Scale – Gottman therapy, scale ۰-۴)
        dps_labels = [  # لیست ۵۴ سوال واقعی از دیتاست – روانشناسی معتبر
            "وقتی بحث‌مان بد پیش می‌رود، یکی از ما عذرخواهی می‌کند و مسئله کش نمی‌آید.",  # Atr1
            "می‌دانم ما می‌توانیم تفاوت‌هایمان را نادیده بگیریم، حتی اگر گاهی سخت شود.",  # Atr2
            "وقتی نیاز داریم، می‌توانیم بحث با پارتنرم را از ابتدا بگیریم و اصلاح کنیم.",  # Atr3 – 
            "وقتی با پارتنرم بحث می‌کنم، در نهایت برایم کار می‌کند که با او تماس بگیرم.",  # Atr4
            "زمان‌هایی که با پارتنرم می‌گذرانم، برای ما خاص است.",  # Atr5
            "ما در خانه به عنوان شریک زمان نداریم.",  # Atr6
            "ما مثل دو غریبه‌ای هستیم که محیط مشترک را به اشتراک می‌گذاریم نه خانواده.",  # Atr7
            "از تعطیلات با پارتنرم لذت می‌برم.",  # Atr8
            "از سفر با پارتنرم لذت می‌برم.",  # Atr9
            "پارتنرم و بیشتر اهداف ما مشترک است.",  # Atr10
            "فکر می‌کنم یک روز در آینده، وقتی به عقب نگاه می‌کنم، می‌بینم که پارتنرم و من با هم هماهنگ هستیم.",  # Atr11
            "پارتنرم و من ارزش‌های مشابهی در مورد آزادی شخصی داریم.",  # Atr12
            "سرگرمی پارتنرم و من مشابه است.",  # Atr13
            "بیشتر اهداف ما برای افراد (کودکان، دوستان، و غیره) مشابه است.",  # Atr14
            "رویاهای ما از زندگی با پارتنرم مشابه و هماهنگ است.",  # Atr15
            "ما با پارتنرم در مورد اینکه عشق باید چه باشد سازگار هستیم.",  # Atr16
            "ما دیدگاه‌های مشابهی با پارتنرم در مورد خوشحال بودن در زندگی داریم.",  # Atr17
            "ایده‌های مشابهی با پارتنرم در مورد اینکه رابطه باید چگونه باشد داریم.",  # Atr18
            "ایده‌های مشابهی با پارتنرم در مورد نقش‌ها در رابطه مان داریم.",  # Atr19
            "ارزش‌های مشابهی با پارتنرم در اعتماد داریم.",  # Atr20
            "دقیقاً می‌دانم پارتنرم چه چیزی دوست دارد.",  # Atr21
            "می‌دانم پارتنرم وقتی بیمار است چگونه مراقبت شود.",  # Atr22
            "غذای مورد علاقه پارتنرم را می‌دانم.",  # Atr23
            "می‌توانم بگویم پارتنرم در زندگی‌اش با چه استرسی روبرو است.",  # Atr24
            "دانش از دنیای درونی پارتنرم دارم.",  # Atr25
            "نگرانی‌های اساسی پارتنرم را می‌دانم.",  # Atr26
            "می‌دانم منابع استرس فعلی پارتنرم چیست.",  # Atr27
            "امیدها و آرزوهای پارتنرم را می‌دانم.",  # Atr28
            "پارتنرم را خیلی خوب می‌شناسم.",  # Atr29
            "دوستان پارتنرم و روابط اجتماعی‌شان را می‌دانم.",  # Atr30
            "وقتی با پارتنرم بحث می‌کنم، احساس تهاجمی می‌کنم.",  # Atr31
            "وقتی با پارتنرم بحث می‌کنم، معمولاً عباراتی مثل 'تو همیشه' یا 'تو هرگز' استفاده می‌کنم.",  # Atr32
            "می‌توانم در بحث‌ها از بیان‌های منفی در مورد شخصیت پارتنرم استفاده کنم.",  # Atr33
            "می‌توانم در بحث‌ها از عبارات توهین‌آمیز استفاده کنم.",  # Atr34
            "می‌توانم در بحث‌ها توهین کنم.",  # Atr35
            "می‌توانم در بحث‌ها تحقیرکننده باشم.",  # Atr36
            "بحث با پارتنرم آرام نیست.",  # Atr37
            "از نحوه مطرح کردن پارتنرم متنفرم.",  # Atr38
            "بحث‌ها اغلب ناگهان رخ می‌دهد.",  # Atr39
            "ما فقط بحث را شروع می‌کنیم قبل از اینکه بدانم چه خبر است.",  # Atr40
            "وقتی با پارتنرم در مورد چیزی صحبت می‌کنم، آرامش من ناگهان می‌شکند.",  # Atr41
            "وقتی با پارتنرم بحث می‌کنم، فقط فریاد می‌زنم و کلمه‌ای نمی‌گویم.",  # Atr42
            "بیشتر تشنه‌ام که محیط را کمی آرام کنم.",  # Atr43
            "گاهی فکر می‌کنم برایم خوب است که مدتی خانه را ترک کنم.",  # Atr44
            "ترجیح می‌دم ساکت بمونم تا با پارتنرم بحث کنم.",  # Atr45
            "حتی اگر در بحث حق با من باشه، تشنه‌ام که طرف مقابل رو ناراحت نکنم.",  # Atr46
            "وقتی با پارتنرم بحث می‌کنم، ساکت می‌مونم چون از کنترل نکردن خشمم می‌ترسم.",  # Atr47
            "در بحث‌هایمان احساس می‌کنم حق با من است.",  # Atr48
            "من در واقع کسی نیستم که متهم بهش شده.",  # Atr49
            "من واقعاً کسی نیستم که مقصر مشکلات خانه باشم.",  # Atr50
            "من کسی نیستم که در مورد مشکلات خانه اشتباه باشه.",  # Atr51
            "نمی‌ترسم از ناکارآمدی پارتنرم بهش بگم.",  # Atr52
            "وقتی بحث می‌کنم، ناکارآمدی‌های پارتنرم رو یادآوری می‌کنم.",  # Atr53
            "از ناتوانی پارتنرم نمی‌ترسم بهش بگم.",  # Atr54
        ]
        #  ۵۴ DPS + ۵ چک (معکوس برای تشخیص دروغ) 
        labels = dps_labels + [  # اضافه ۵ چک – معکوس سوال‌های کلیدی (۱,۱۰,۲۰,۳۰,۴۰).
            "معکوس: وقتی بحث بد پیش می‌ره، عذرخواهی نمی‌کنه و مسئله کش می‌آد.",  # چک q1 (معکوس).
            "معکوس: نمی‌دونم اهدافمون مشترکه.",  # چک q10.
            "معکوس: اعتمادمون ضعیفه.",  # چک q20.
            "معکوس: دنیای درونی پارتنرم رو نمی‌شناسم.",  # چک q30 –
            "معکوس: بحث‌ها آرام هستن.",  # چک q40.
        ]
        for i in range(1, 60):  # loop از ۱ تا ۵۹ – dynamic بدون کد تکراری.
            field = forms.IntegerField(  # IntegerField برای عدد – validation عددی.
                label=labels[i-1],  # لیبل واقعی از لیست – چرا؟ روانشناسی معتبر DPS.
                min_value=0,  # حداقل ۰ – scale DPS.
                max_value=4,  # حداکثر ۴ – scale ۰-۴.
                initial=2,  # مقدار پیش‌فرض متوسط – چرا؟ برای تست آسان.
                required=True,  # اجباری – چرا؟ همه سوالات لازم.
                widget=forms.NumberInput(attrs={  # NumberInput با type='range' – slider HTML5.
                    'type': 'range',  # type range برای slider – سازگار همه نسخه‌ها.
                    'class': 'form-range',  # کلاس Bootstrap – استایل slider.
                    'min': 0,  # min attribute.
                    'max': 4,  # max.
                    'step': 1,  # integer.
                    'style': 'width: 100%; margin: 10px 0;'  # عرض و فاصله.
                })
            )
            self.fields[f'q{i}'] = field  # اضافه به fields – key 'q1' تا 'q59'.

    # clean() برای validation  چک مجموع امتیازات.
    def clean(self):  # override clean parent – validation بعد field-level.
        cleaned_data = super().clean()  # super clean – فیلدهای تمیز.
        total_score = 0  # مجموع initial ۰.
        for key, value in cleaned_data.items():  # loop items.
            if key.startswith('q') and value is not None:  # چک 'q' و not None – امن.
                total_score += int(value)  # جمع int – بدون error.
        if total_score < 50:  # شرط مثال – <۵۰ ریسک بالا.
            raise forms.ValidationError('امتیازات پایین ممکن است نشان‌دهنده ریسک باشد. دوباره چک کنید.')  # خطای کلی.
        return cleaned_data  # بازگشت.